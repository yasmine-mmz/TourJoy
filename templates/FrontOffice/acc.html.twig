{% extends 'FrontOffice/navbar.html.twig' %}

{% block body %}
<div class="container">
    <br>
    <br>
    <br>
    <h1 class="text-center mb-4" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); font-size: 36px;">Explore Our Luxurious Accommodations</h1>
    <br>
    <div class="row">
        <div class="col-md-3">
            <div class="card border-secondary mb-3">
                <div class="card-header bg-transparent border-secondary text-center rounded-top" style="border-top-left-radius: 20px; border-top-right-radius: 20px;">
                    <h4 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin-bottom: 0;">Filter</h4>
                </div>
                <div class="card-body" style="background-color: #f5f5f5; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;">
                    <h5 class="card-title">Price</h5>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox price-filter" type="checkbox" value="100-500" id="price1">
                        <label class="form-check-label" for="price1" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">100 TND - 500 TND</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox price-filter" type="checkbox" value="501-1000" id="price2">
                        <label class="form-check-label" for="price2" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">501 TND - 1000 TND</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox price-filter" type="checkbox" value="1001-3000000000000000" id="price3">
                        <label class="form-check-label" for="price3" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">More than 1000 TND</label>
                    </div>
                    <hr>
                    <h5 class="card-title">Type</h5>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox type-filter" type="checkbox" value="resort" id="type1">
                        <label class="form-check-label" for="type1" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Resort</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox type-filter" type="checkbox" value="apartment" id="type2">
                        <label class="form-check-label" for="type2" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Apartment</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox type-filter" type="checkbox" value="villa" id="type3">
                        <label class="form-check-label" for="type3" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Villa</label>
                    </div>
                    <hr>
                    <h5 class="card-title">Room Number</h5>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox room-filter" type="checkbox" value="1" id="room1">
                        <label class="form-check-label" for="room1" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">1</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox room-filter" type="checkbox" value="2" id="room2">
                        <label class="form-check-label" for="room2" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">2</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox room-filter" type="checkbox" value="3" id="room3">
                        <label class="form-check-label" for="room3" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">3</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox room-filter" type="checkbox" value="4" id="room4">
                        <label class="form-check-label" for="room4" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">4</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox room-filter" type="checkbox" value="5" id="room5">
                        <label class="form-check-label" for="room5" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">5</label>
                    </div>
                    <div class="form-check text-center">
                        <input class="form-check-input filter-checkbox room-filter" type="checkbox" value="6" id="room6">
                        <label class="form-check-label" for="room6" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">6</label>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="col-md-9">
            <!-- Search Input -->
            <div class="input-group mb-3">
                <input type="text" id="accommodation-search" class="form-control" placeholder="Search Accommodations">
            </div>

            <!-- Accommodations -->
            <div class="row accommodations">
                {% for t in response %}
                <div class="col-lg-4 col-md-6 mb-4 accommodation-item {{ t.type }}" data-price="{{ t.price }}" data-type="{{ t.type }}" data-rooms="{{ t.nbRooms }}">
                    <div class="card h-100 border-light bg-light-gray rounded-circle-border">
                        <img src="{{ vich_uploader_asset(t, 'imageFile') }}" class="card-img-top rounded-circle img-fluid" alt="{{ t.name }}" style="height: 200px; object-fit: cover; transition: transform 0.3s ease-in-out;">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h5 class="card-title">{{ t.name }}</h5>
                            <p class="card-text text-orange font-weight-bold">Price of one night : {{ t.price }} TND</p>
                            <p class="card-text">Country: {{ t.fkpays }}</p>
                            <p class="card-text">Rooms: {{ t.nbRooms }}</p>
                            <div class="text-center mt-auto">
                                <div class="d-flex justify-content-center align-items-end">
        {% if app.user %}
            <a href="{{ path('book_accommodation', {'refA': t.refA}) }}" class="btn btn-info btn-sm rounded-pill mx-2">Book</a>
        {% else %}
            <a href="{{ path('app_login') }}" class="btn btn-info btn-sm rounded-pill mx-2">Book</a>
        {% endif %}                                    <a href="{{ path('favorites_add', {'refA': t.refA}) }}" class="btn btn-info btn-sm rounded-pill mx-2">Favorites</a>
                                    <button class="btn btn-success btn-sm rounded-pill mx-2" onclick="showMap('{{ t.location }}')" style="font-size: 20px; background-color: transparent; border: none;"><span style="color: #28a745;">üìç</span></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
    .bg-light-gray {
        background-color: #f5f5f5;
    }
    .rounded-circle-border {
        border-radius: 20px;
    }
    .rounded-circle {
        border-radius: 20px 20px 20px 20px;
    }
    .btn {
        border-radius: 10px;
        font-size: 14px;
    }
    .form-check-input {
        width: 20px;
        height: 20px;
    }
    .form-check-label {
        font-size: 14px;
        padding-left: 5px;
        display: inline-block;
        vertical-align: middle;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const accommodations = document.querySelector('.accommodations');
        const checkboxes = document.querySelectorAll('.filter-checkbox');
        const searchInput = document.getElementById('accommodation-search');

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', applyFilters);
        });

        searchInput.addEventListener('input', function() {
            applySearch(searchInput.value.toLowerCase());
        });

 function applyFilters() {
    const selectedPrices = Array.from(document.querySelectorAll('.price-filter:checked')).map(checkbox => checkbox.value);
    const selectedTypes = Array.from(document.querySelectorAll('.type-filter:checked')).map(checkbox => checkbox.value);
    const selectedRooms = Array.from(document.querySelectorAll('.room-filter:checked')).map(checkbox => checkbox.value);

    accommodations.querySelectorAll('.accommodation-item').forEach(item => {
        const price = parseFloat(item.getAttribute('data-price'));
        const type = item.getAttribute('data-type');
        const rooms = parseInt(item.getAttribute('data-rooms'));

        const priceMatch = selectedPrices.length === 0 || selectedPrices.some(priceRange => {
            const [min, max] = priceRange.split('-').map(Number);
            return price >= min && price <= max;
        });

        const typeMatch = selectedTypes.length === 0 || selectedTypes.includes(type);

        const roomsMatch = selectedRooms.length === 0 || selectedRooms.includes(String(rooms));

        // Check if no checkboxes are checked, then display the item
        if (selectedPrices.length === 0 && selectedTypes.length === 0 && selectedRooms.length === 0) {
            item.style.display = 'block';
        } else {
            if (priceMatch && typeMatch && roomsMatch) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        }
    });
}

        function applySearch(query) {
            accommodations.querySelectorAll('.accommodation-item').forEach(item => {
                // Get the text content for name, price, and number of rooms
                const name = item.querySelector('.card-title').textContent.toLowerCase();
                const priceText = item.querySelector('.card-text.text-orange').textContent.toLowerCase().replace('price of one night : ', '').replace(' tnd', '');
                const roomsText = item.querySelector('.card-text:not(.text-orange)').textContent.toLowerCase().replace('rooms: ', '');

                // Combine all text content into a single searchable string
                const searchableText = name + " " + priceText + " " + roomsText;

                // Check if the searchableText includes the query
                if (searchableText.includes(query)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
    });




    function showMap(location) {
        const googleMapsUrl = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(location);
        window.open(googleMapsUrl, '_blank');
    }
</script>
{% endblock %}
